<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Delivery - Proyecto NoSQL</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #eef1f5;
      margin: 0;
      padding: 0;
    }

    header {
      background: #212529;
      color: #fff;
      padding: 20px;
      text-align: center;
      font-size: 26px;
      font-weight: bold;
    }

    .container {
      width: 90%;
      margin: auto;
      margin-top: 20px;
    }

    h2 {
      margin-top: 40px;
      color: #333;
    }

    .box {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
      box-shadow: 0px 3px 8px rgba(0,0,0,0.2);
    }

    button {
      padding: 10px 16px;
      background: #007bff;
      border: none;
      border-radius: 6px;
      color: white;
      font-size: 15px;
      cursor: pointer;
      margin-right: 8px;
      margin-top: 8px;
      transition: 0.2s;
    }

    button:hover {
      background: #0056b3;
    }

    pre {
      background: #1e1e1e;
      color: #00ff66;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      max-height: 300px;
    }

    input, select {
      padding: 8px;
      margin: 5px;
      border-radius: 6px;
      border: 1px solid #aaa;
    }

    #mensaje {
      background: #d1e7dd;
      color: #0f5132;
      padding: 12px;
      margin-top: 10px;
      border-radius: 8px;
      display: none;
      font-weight: bold;
      border: 1px solid #badbcc;
    }
    #mensaje.error {
      background: #f8d7da;
      color: #842029;
      border: 1px solid #f5c2c7;
    }
  </style>
</head>
<body>

<header>Sistema Delivery - CRUD + Consulta Compleja</header>

<div class="container">

  <div id="mensaje"></div>

  <!-- ========================= -->
  <!-- RESTAURANTES -->
  <!-- ========================= -->
  <h2>Restaurantes</h2>
  <div class="box">
    <button onclick="getRestaurantes()">Mostrar restaurantes</button>

    <h3>Crear restaurante</h3>
    <div class="row">
      <input id="restName" placeholder="Nombre">
      <input id="restCat" placeholder="Categorias separadas por coma">
    </div>
    <button onclick="crearRestaurante()">Crear</button>

    <h3>Eliminar restaurante</h3>
    <input id="restDeleteId" placeholder="ID">
    <button onclick="borrarRestaurante()">Eliminar</button>

    <pre id="restaurantes"></pre>
  </div>

  <!-- ========================= -->
  <!-- RIDERS -->
  <!-- ========================= -->
  <h2>Riders</h2>
  <div class="box">
    <button onclick="getRiders()">Mostrar riders</button>

    <h3>Crear rider</h3>
    <input id="riderName" placeholder="Nombre">
    <input id="riderVeh" placeholder="Vehículo">
    <select id="riderEstado">
      <option value="disponible">disponible</option>
      <option value="ocupado">ocupado</option>
    </select>
    <button onclick="crearRider()">Crear</button>

    <h3>Eliminar rider</h3>
    <input id="riderDeleteId" placeholder="ID">
    <button onclick="borrarRider()">Eliminar</button>

    <pre id="riders"></pre>
  </div>

  <!-- ========================= -->
  <!-- USUARIOS -->
  <!-- ========================= -->
  <h2>Usuarios</h2>
  <div class="box">
    <button onclick="getUsuarios()">Mostrar usuarios</button>

    <h3>Crear usuario</h3>
    <input id="userName" placeholder="Nombre">
    <input id="userDir" placeholder="Direccion">
    <input id="userTel" placeholder="Teléfono">
    <button onclick="crearUsuario()">Crear</button>

    <h3>Eliminar usuario</h3>
    <input id="userDeleteId" placeholder="ID">
    <button onclick="borrarUsuario()">Eliminar</button>

    <pre id="usuarios"></pre>
  </div>

  <!-- ========================= -->
  <!-- PEDIDOS -->
  <!-- ========================= -->
  <h2>Pedidos</h2>
  <div class="box">
    <button onclick="getPedidos()">Mostrar pedidos</button>

    <h3>Crear pedido</h3>
    <input id="pedidoUser" placeholder="usuarioId">
    <input id="pedidoRest" placeholder="restauranteId">
    <input id="pedidoRider" placeholder="riderId (opcional)">
    <input id="pedidoPlato" placeholder="Plato">
    <input id="pedidoCant" placeholder="Cantidad">
    <input id="pedidoPrecio" placeholder="Precio unitario">
    <button onclick="crearPedido()">Crear</button>

    <h3>Eliminar pedido</h3>
    <input id="pedidoDeleteId" placeholder="ID">
    <button onclick="borrarPedido()">Eliminar</button>

    <pre id="pedidos"></pre>
  </div>

  <!-- ========================= -->
  <!-- CONSULTA COMPLEJA -->
  <!-- ========================= -->
  <h2>Consulta Compleja</h2>
  <div class="box">
    <button onclick="consultaActivos()">Pedidos activos agrupados por rider</button>
    <pre id="consulta"></pre>
  </div>

</div>

<script>
  const API = "http://localhost:3000";

  // Mostrar mensaje bonito arriba
  function mensaje(texto, error = false) {
    const box = document.getElementById("mensaje");
    box.style.display = "block";
    box.textContent = texto;
    box.className = error ? "error" : "";
    setTimeout(() => box.style.display = "none", 3000);
  }

  // Mostrar datos en pantalla
  function mostrar(id, data){
    document.getElementById(id).textContent = JSON.stringify(data, null, 2);
  }

  // ======================
  // GET generales
  // ======================
  const getRestaurantes = () =>
    fetch(`${API}/restaurantes`)
      .then(r => r.json())
      .then(d => mostrar("restaurantes", d));

  const getRiders = () =>
    fetch(`${API}/riders`)
      .then(r => r.json())
      .then(d => mostrar("riders", d));

  const getUsuarios = () =>
    fetch(`${API}/usuarios`)
      .then(r => r.json())
      .then(d => mostrar("usuarios", d));

  const getPedidos = () =>
    fetch(`${API}/pedidos`)
      .then(r => r.json())
      .then(d => mostrar("pedidos", d));

  // ======================
  // POST (Crear)
  // ======================

  function crearRestaurante(){
    const nombre = restName.value;
    const categorias = restCat.value.split(",");

    fetch(`${API}/restaurantes`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ nombre, categorias })
    })
    .then(() => {
      mensaje("Restaurante creado correctamente");
      restName.value = "";
      restCat.value = "";
      getRestaurantes();
    })
    .catch(() => mensaje("Error creando restaurante", true));
  }

  function crearRider(){
    const nombre = riderName.value;
    const vehiculo = riderVeh.value;
    const estado = riderEstado.value;

    fetch(`${API}/riders`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ nombre, vehiculo, estado })
    })
    .then(() => {
      mensaje("Rider creado");
      riderName.value = "";
      riderVeh.value = "";
      getRiders();
    })
    .catch(() => mensaje("Error creando rider", true));
  }

  function crearUsuario(){
    fetch(`${API}/usuarios`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        nombre: userName.value,
        direccion: userDir.value,
        telefono: userTel.value
      })
    })
    .then(() => {
      mensaje("Usuario creado");
      userName.value = "";
      userDir.value = "";
      userTel.value = "";
      getUsuarios();
    })
    .catch(() => mensaje("Error creando usuario", true));
  }

  function crearPedido(){
    const datos = {
      usuarioId: pedidoUser.value,
      restauranteId: pedidoRest.value,
      riderId: pedidoRider.value || null,
      items: [{
        plato: pedidoPlato.value,
        cantidad: Number(pedidoCant.value),
        precio_unitario: Number(pedidoPrecio.value)
      }]
    };

    fetch(`${API}/pedidos`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(datos)
    })
    .then(() => {
      mensaje("Pedido creado");
      pedidoUser.value = "";
      pedidoRest.value = "";
      pedidoRider.value = "";
      pedidoPlato.value = "";
      pedidoCant.value = "";
      pedidoPrecio.value = "";
      getPedidos();
    })
    .catch(() => mensaje("Error creando pedido", true));
  }

  // ======================
  // DELETE (Eliminar)
  // ======================

  function borrarRestaurante(){
    fetch(`${API}/restaurantes/${restDeleteId.value}`, { method: "DELETE" })
      .then(() => {
        mensaje("Restaurante eliminado");
        restDeleteId.value = "";
        getRestaurantes();
      })
      .catch(() => mensaje("Error eliminando restaurante", true));
  }

  function borrarRider(){
    fetch(`${API}/riders/${riderDeleteId.value}`, { method: "DELETE" })
      .then(() => {
        mensaje("Rider eliminado");
        riderDeleteId.value = "";
        getRiders();
      })
      .catch(() => mensaje("Error eliminando rider", true));
  }

  function borrarUsuario(){
    fetch(`${API}/usuarios/${userDeleteId.value}`, { method: "DELETE" })
      .then(() => {
        mensaje("Usuario eliminado");
        userDeleteId.value = "";
        getUsuarios();
      })
      .catch(() => mensaje("Error eliminando usuario", true));
  }

  function borrarPedido(){
    fetch(`${API}/pedidos/${pedidoDeleteId.value}`, { method: "DELETE" })
      .then(() => {
        mensaje("Pedido eliminado");
        pedidoDeleteId.value = "";
        getPedidos();
      })
      .catch(() => mensaje("Error eliminando pedido", true));
  }

  // ======================
  // CONSULTA COMPLEJA
  // ======================

  function consultaActivos(){
    fetch(`${API}/pedidos/activos`)
      .then(r => r.json())
      .then(d => {
        mostrar("consulta", d);
        mensaje("Consulta ejecutada");
      })
      .catch(() => mensaje("Error ejecutando consulta", true));
  }
</script>

</body>
</html>
